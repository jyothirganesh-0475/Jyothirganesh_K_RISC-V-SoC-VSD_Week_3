# 🧠 Post-Synthesis Gate Level Simulation (GLS) — VSDBabySoC

## 📌 Introduction

Gate-Level Simulation (GLS) is performed **after the synthesis stage** to verify the **functional and timing correctness** of the design at the **gate level**.
Unlike RTL simulation, GLS uses the synthesized **netlist**, which contains actual standard cells and interconnections, giving a more realistic view of how the SoC will behave in silicon.

---

## **What Post-Synthesis (GLS) Actually Does**

1. **Uses Synthesized Netlist**

   * Unlike RTL simulation (which uses abstract behavioral models), GLS simulates the **actual gates** and **connections** generated by synthesis (AND, OR, DFF, etc.).

2. **Verifies Functional Correctness**

   * Ensures that after synthesis, the logic still works as intended.
   * Example: The RISC-V core still executes instructions correctly, clocks propagate as expected, and modules like PLL/DAC behave properly.

3. **Checks Timing Behavior**

   * GLS can include **unit delays** or **SDF delays** to simulate realistic timing.
   * Detects potential **glitches, hazards, or setup/hold violations** that are invisible at RTL.

4. **Detects Post-Synthesis Issues Early**

   * Helps catch problems like:

     * Incorrect flip-flop behavior
     * Clock gating or asynchronous issues

5. **Prepares for STA & Physical Design**

   * GLS confirms that the netlist is **functionally correct**, which is necessary before performing **Static Timing Analysis (STA)** and eventual tapeout.

---



## 🎯 Purpose of GLS

The main purpose of **Post-Synthesis Gate-Level Simulation (GLS)** is to **verify the functionality and timing of this synthesized netlist** before going to physical design (place-and-route).

* ✅ **Timing Verification:** Ensures the design works correctly with real-world timing (through delays from the synthesized netlist or SDF files).
* 🧪 **Functional Check:** Confirms the design still behaves as expected after synthesis mapping.
* 🧭 **Glitch & Metastability Detection:** Detects issues that are not visible in RTL simulation.
* 🧰 **Integration Validation:** Verifies correct interaction between blocks like the RISC-V core, PLL, and DAC in the final netlist.

---


## 🪜 High-Level GLS Flow Summary

#### **1. Perform synthesis of the BabySoC design**

#### **2. Run Gate-Level Simulation (GLS) using the synthesized netlist**

#### **3. Compare GLS output with functional simulation output (Week 2)**
###  **4. ✅ “GLS output matches functional simulation output.”

### 📦 Deliverables

* 📝 `yosys` synthesis logs
* 🖼️ GLS waveform screenshots (`gtkwave`)
* 🧾 A short note confirming:

---

## 📜 Here is the list of steps for the post-Synthesis (GLS) flow.

1. **[Load the design files into Yosys](#step-1-load-design-files-into-yosys)**
2. **[Load Liberty timing libraries](#step-2-load-liberty-timing-libraries)**
3. **[Run synthesis for the top module](#step-3-synthesize-the-top-module)**
4. **[Map D Flip-Flops to standard cells](#step-4-map-d-flip-flops-to-standard-cells)**
5. **[Perform optimization and technology mapping](#step-5-technology-mapping--optimization)**
6. **[Final clean-up of the netlist](#step-6-final-clean-up)**
7. **[Check post-synthesis statistics](#step-7-check-statistics)**
8. **[Write the synthesized gate-level netlist](#step-8-write-the-synthesized-netlist)**
9. **[Compile the testbench and synthesized netlist using Icarus Verilog](#step-9-compile-testbench-and-netlist)**
10. **[Navigate to the simulation output directory](#step-10-navigate-to-output-directory)**
11. **[Run the post-synthesis simulation](#step-11-run-the-simulation)**
12. **[View the waveform using GTKWave](#step-12-view-waveforms-in-gtkwave)**

---


## 🪜 Step-by-Step Post-Synthesis Flow

### 🏗️ Step 1: Load Design Files into Yosys

```bash
yosys
```
<img width="1210" height="672" alt="Image" src="https://github.com/user-attachments/assets/548f1845-32ce-4088-af52-c3b43e94f974" />

Inside the Yosys shell:

```tcl
read_verilog /home/jyothirganesh/VLSI/VSDBabySoC/src/module/vsdbabysoc.v
read_verilog -I /home/jyothirganesh/VLSI/VSDBabySoC/src/include /home/jyothirganesh/VLSI/VSDBabySoC/src/module/rvmyth.v
read_verilog -I /home/jyothirganesh/VLSI/VSDBabySoC/src/include /home/jyothirganesh/VLSI/VSDBabySoC/src/module/clk_gate.v
```

📝 **Explanation:**

* `read_verilog` loads Verilog RTL source files.
* `-I` specifies include directories.
* Load the top-level SoC module (`vsdbabysoc`) and supporting modules (RISC-V core and clock gate).
<img width="1207" height="596" alt="Image" src="https://github.com/user-attachments/assets/be9a6a8f-5922-43de-a7f7-51ce5895ac5c" />
<img width="1208" height="350" alt="Image" src="https://github.com/user-attachments/assets/a7eaf70c-7e4c-4005-8657-840a82f74d76" />
---

### 📚 Step 2: Load Liberty Timing Libraries

```tcl
read_liberty -lib /home/jyothirganesh/VLSI/VSDBabySoC/src/lib/avsdpll.lib
read_liberty -lib /home/jyothirganesh/VLSI/VSDBabySoC/src/lib/avsddac.lib
read_liberty -lib /home/jyothirganesh/VLSI/VSDBabySoC/src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
📝 **Explanation:**

* Liberty files describe the **timing and power** characteristics of standard cells.
* Yosys uses this information to map RTL logic to physical cells during synthesis.
<img width="1216" height="486" alt="Image" src="https://github.com/user-attachments/assets/21df72a3-1175-4be9-9407-10bf33a4a805" />
---

### 🧭 Step 3: Synthesize the Top Module

```tcl
synth -top vsdbabysoc
```
* Which  Converts RTL design to a technology-independent netlist.
* `-top` specifies the top module to synthesize.
<img width="1216" height="687" alt="Image" src="https://github.com/user-attachments/assets/5bb5bde4-6b9e-4a1e-9ecb-5953098e3f51" />
<img width="1216" height="687" alt="Image" src="https://github.com/user-attachments/assets/fb02a8db-2e71-4624-bf0f-45717113dc67" />
<img width="1209" height="517" alt="Image" src="https://github.com/user-attachments/assets/7eb15608-93fa-4c10-bd9a-50b84e841cd1" />
<img width="1214" height="297" alt="Image" src="https://github.com/user-attachments/assets/ddf87a82-371f-4e98-af5b-0616b4dfe79e" />
<img width="1210" height="687" alt="Image" src="https://github.com/user-attachments/assets/2b5d3071-0d39-4dc8-b698-26fec9b34cfb" />
<img width="1215" height="156" alt="Image" src="https://github.com/user-attachments/assets/abdb4b33-4b54-4cb7-8461-cfd3986fc1d6" />
---

### ⚡ Step 4: Map D Flip-Flops to Standard Cells

* Maps all generic DFFs to actual **standard cell DFFs** from the Sky130 library.

```tcl
dfflibmap -liberty /home/jyothirganesh/VLSI/VSDBabySoC/src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib
```
<img width="1211" height="726" alt="Image" src="https://github.com/user-attachments/assets/231f28b4-f1b4-4ea7-8b77-98a8fa64161b" />

---

### 🧠 Step 5: Technology Mapping & Optimization

```tcl
opt
abc -liberty /home/jyothirganesh/VLSI/VSDBabySoC/src/lib/sky130_fd_sc_hd__tt_025C_1v80.lib -script +strash;scorr;ifraig;retime;{D};strash;dch,-f;map,-M,1,{D}
```


* `opt` — performs cleanup and simple optimizations.
* `abc` — maps logic to actual cells and optimizes area and timing.

<img width="1213" height="705" alt="Image" src="https://github.com/user-attachments/assets/e6b2492a-0060-4d70-8566-100fb45cbb62" />
<img width="1223" height="387" alt="Image" src="https://github.com/user-attachments/assets/26febe51-2688-489d-8d4d-8f9727d27710" />
<img width="1215" height="686" alt="Image" src="https://github.com/user-attachments/assets/20921c57-10c8-4624-95ef-9b292f6c1cf2" />

---

### 🧹 Step 6: Final Clean-Up

```tcl
flatten
setundef -zero
clean -purge
rename -enumerate
```

📝 **Explanation:**

* `flatten` — flattens hierarchy into a single module.
* `setundef -zero` — removes undefined states by setting them to 0.
* `clean -purge` — deletes unused signals.
* `rename -enumerate` — renames signals systematically.
<img width="1216" height="328" alt="Screenshot from 2025-10-05 12-25-36" src="https://github.com/user-attachments/assets/7bd3893a-ad25-4182-9e7c-f47aada39fed" />
---

### 📊 Step 7: Check Statistics

```tcl
stat
```

📝 **Explanation:**

* Displays **number of cells**, area, and design resources after synthesis.
<img width="1217" height="681" alt="Screenshot from 2025-10-05 12-26-14" src="https://github.com/user-attachments/assets/ff7df888-2cc8-417a-80aa-9de0748ce218" />
<img width="1217" height="681" alt="Screenshot from 2025-10-05 12-26-30" src="https://github.com/user-attachments/assets/7da8b1af-bd19-4217-83ff-4fd2f9f3f9d3" />

---

### 💾 Step 8: Write the Synthesized Netlist

```tcl
write_verilog -noattr /home/jyothirganesh/VLSI/VSDBabySoC/src/module/vsdbabysoc.synth.v
```
📝 **Explanation:**

* Writes the **final synthesized netlist** to the specified path.
* `-noattr` removes extra attributes for a clean file.
<img width="1214" height="208" alt="Screenshot from 2025-10-05 12-29-44" src="https://github.com/user-attachments/assets/eea41a5b-b2e5-47c2-b1e5-e2055bd14dcf" />

---
## Create a directory post_synth_sim in output directorty
```bash
mkdir /home/jyothirganesh/VLSI/VSDBabySoC/output/post_synth_sim
```
* which directory stores the sythesised netlist (.out file) and simulation output (.vcd file)

## 🧪 Post-Synthesis Simulation (GLS)

### 🧰 Step 9: Compile Testbench and Netlist

```bash
iverilog -o /home/jyothirganesh/VLSI/VSDBabySoC/output/post_synth_sim/post_synth_sim.out \
-DPOST_SYNTH_SIM -DFUNCTIONAL -DUNIT_DELAY=#1 \
-I /home/jyothirganesh/VLSI/VSDBabySoC/src/include \
-I /home/jyothirganesh/VLSI/VSDBabySoC/src/module \
/home/jyothirganesh/VLSI/VSDBabySoC/src/gls_model/primitives.v \
/home/jyothirganesh/VLSI/VSDBabySoC/src/gls_model/sky130_fd_sc_hd.v \
/home/jyothirganesh/VLSI/VSDBabySoC/src/module/testbench.v
```

📝 **Explanation:**

* `iverilog` — compiles Verilog files for simulation.
* `-DPOST_SYNTH_SIM` — macro for post-synthesis environment.
* `-DFUNCTIONAL` — functional mode without SDF.
* `-DUNIT_DELAY=#1` — unit delays simulate timing behavior.
* Combines testbench and synthesized netlist.
<img width="1217" height="217" alt="Screenshot from 2025-10-07 22-08-52" src="https://github.com/user-attachments/assets/3fcd8014-d87e-41c0-8b34-e87f7e607516" />

---

### 📂 Step 10: Navigate to Output Directory

```bash
cd /home/jyothirganesh/VLSI/VSDBabySoC/output/post_synth_sim/
```
### ▶️ Step 11: Run the Simulation

```bash
./post_synth_sim.out
```

📝 **Explanation:**

* Runs the compiled simulation binary.
* Generates `post_synth_sim.vcd` (waveform file).
<img width="1213" height="132" alt="Screenshot from 2025-10-07 22-15-13" src="https://github.com/user-attachments/assets/d8e3cfad-3f2f-494a-8ea4-e1f707d4c6dd" />

---

### 📈 Step 12: View Waveforms in GTKWave

```bash
gtkwave post_synth_sim.vcd
```

📝 **Explanation:**

* Opens GTKWave to visualize signal transitions at gate level.
* Useful for verifying behavior and timing issues.
<img width="1854" height="1047" alt="Screenshot from 2025-10-08 15-38-23" src="https://github.com/user-attachments/assets/f7d509c5-623e-4ab0-90e1-7d44c87d8de1" />

<img width="1854" height="1047" alt="Screenshot from 2025-10-08 15-38-46" src="https://github.com/user-attachments/assets/c63f2ffe-ca04-4806-a34c-f5ff30d02d8d" />

---

## 🏁 Summary Table

| Stage           | Tool / Command         | Purpose                                |
| --------------- | ---------------------- | -------------------------------------- |
| RTL to Netlist  | `yosys` synthesis flow | Convert RTL to gate-level netlist      |
| Liberty Mapping | `read_liberty`, `abc`  | Use real standard cells                |
| Netlist Export  | `write_verilog`        | Generate `.synth.v`                    |
| GLS             | `iverilog` + `gtkwave` | Post-synthesis functional verification |

---

## 🧾 Result Verification

This section confirms that the **Gate-Level Simulation (GLS)** output matches the **Week 2 functional simulation output**.
The foolowing wave form is **week 2 functional simlation output** i.e **pre_synth_out**
<img width="1213" height="776" alt="image" src="https://github.com/user-attachments/assets/2d9b83e9-af32-46cc-97b9-3a40723c687e" />

<img width="1203" height="563" alt="image" src="https://github.com/user-attachments/assets/deff8c4c-ba34-4a14-be23-11241a5a4d82" />


* ✅ GLS waveform matches the functional simulation output.
* Key signals verified: **clock**, **reset**, and **RISC-V core outputs**.
* No glitches, hazards, or functional mismatches observed.

**✔️ GLS = Functional Outputs Confirmed**

---

## 🧠 Key Takeaways

* ✅ GLS verifies functionality **after** synthesis with real cell delays.
* ⏱️ Helps detect glitches, hazards, and integration issues early.
* 🧰 A crucial step before physical design (P&R) and tapeout.
* 📊 Can be extended with SDF for more accurate delay simulation.

---

## 🏁 Conclusion

* The **Post-Synthesis Gate-Level Simulation (GLS)** of VSDBabySoC was successfully completed.
* GLS results were **verified against the Week 2 functional simulation**, and all outputs matched.
* The flow demonstrates the importance of **synthesized netlist verification** before physical design and STA.
* This task provided hands-on experience with **Yosys synthesis**, **Icarus Verilog simulation**, and **GTKWave waveform analysis**, forming a solid foundation for **Static Timing Analysis (STA)** in subsequent tasks.

---
